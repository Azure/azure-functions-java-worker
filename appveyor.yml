version: '{build}'

image: Visual Studio 2017

pull_requests:
  do_not_increment_build_number: true

branches:
  only:
    - dev
    - master

environment:
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
  DOTNET_VERSION: 2.1.402
  
  matrix:
    - JAVA_HOME: C:\Program Files\Java\jdk1.8.0

install:
  - ps: Get-Command mvn
  - cmd: mvn -v
  - ps: Get-Command nuget
  - cmd: echo %JAVA_HOME%
  - cmd: dotnet --info
  
build_script:
  - cmd: mvn clean package -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -B
  - ps: |
      $buildNumber = 0      
      if($env:APPVEYOR_REPO_TAG -eq "true") {
       $buildNumber = ""
       Write-Host â€œFound git tag. Not setting package suffix"
      } 
      else {
       $buildNumber = "-$env:APPVEYOR_BUILD_NUMBER"
       Write-Host â€œgit tag not found. Setting package suffix to '$buildNumber'"
      }     
      .\package.ps1 -buildNumber $buildNumber

artifacts:
- path: 'pkg/*.nupkg'

cache:
  - C:\maven\

test_script:
  - ps: >
      .\run-tests.ps1